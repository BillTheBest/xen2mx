CC	=	gcc

CFLAGS	=	-Wall
CFLAGS	+=	-g -O2
CFLAGS	+=	-imacros @top_builddir@/common/mpoe_config.h
CFLAGS	+=	-I@top_srcdir@/common

SRCS	=	$(wildcard @srcdir@/*.c)
OBJS	=	$(patsubst @srcdir@/%.c,%.o,$(SRCS))
LIBOBJS	=	$(filter-out mpoe_assertions.o,$(OBJS))
LIB	=	libmpoe.a

.PHONY: all assertions clean distclean

all: $(LIB) assertions

########
# build

$(LIB): $(LIBOBJS)
	ar cr $@ $<

assertions: mpoe_assertions.o

$(OBJS): %.o: @srcdir@/%.c @srcdir@/mpoe_lib.h @srcdir@/mpoe_internals.h
	$(CC) -c $(CFLAGS) $< -o $@

########
# clean

clean:
	$(RM) $(LIB) $(OBJS)

distclean: clean
