.PHONY: all driver tests clean clean-driver clean-tests

all: driver tests

clean: clean-driver clean-lib clean-tests

driver:
	$(MAKE) -C driver/linux

clean-driver:
	$(MAKE) -C driver/linux clean

lib:
	$(MAKE) -C libmpoe

clean-lib:
	$(MAKE) -C libmpoe clean

tests: lib
	$(MAKE) -C tests 

clean-tests:
	$(MAKE) -C tests clean

wc:
	wc -cl \
		driver/linux/*.[ch] \
		common/*.h \
		libmpoe/*.[ch] \
		tests/*.c

dist:
	olddir=$$(basename $$PWD) && newdir=mpoe-svn.$$(date +%Y%m%d.%H%M%S) && cd .. \
	 && cp -a $$olddir $$newdir && find $$newdir -type d | grep '\.svn$$' | xargs rm -rf \; \
	 && cd $$newdir && autoreconf -f && rm -rf autom4te.cache/ && cd .. \
	 && tar cfz $${newdir}.tar.gz $$newdir \
	 && rm -rf $$newdir \
	 && cd $$olddir
