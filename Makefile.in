.PHONY: all clean distcleqn
.PHONY: driver driver-clean driver-distclean
.PHONY: lib lib-clean lib-distclean
.PHONY: tools tools-clean tools-distclean
.PHONY: tests tests-clean tests-distclean

all: driver lib tools tests

clean: driver-clean lib-clean tools-clean tests-clean

distclean: driver-distclean lib-distclean tools-distclean tests-distclean

driver driver-clean driver-distclean:
	$(MAKE) -C driver/linux $(shell echo $@ | cut -s -d- -f2)

lib lib-clean lib-distclean:
	$(MAKE) -C libopenmx $(shell echo $@ | cut -s -d- -f2)

# the lib is required before linking the tools or tests
tools tests: lib

tools tools-clean tools-distclean:
	$(MAKE) -C tools $(shell echo $@ | cut -s -d- -f2)

tests tests-clean tests-distclean:
	$(MAKE) -C tests $(shell echo $@ | cut -s -d- -f2)

wc:
	wc -cl \
		driver/linux/*.[ch] \
		common/*.h \
		libopenmx/*.[ch] \
		tools/*.c \
		tests/*.c

dist:
	olddir=$$(basename $$PWD) && newdir=mpoe-svn.$$(date +%Y%m%d.%H%M%S) && cd .. \
	 && cp -a $$olddir $$newdir && find $$newdir -type d | grep '\.svn$$' | xargs rm -rf \; \
	 && cd $$newdir && autoreconf -f && rm -rf autom4te.cache/ && cd .. \
	 && tar cfz $${newdir}.tar.gz $$newdir \
	 && rm -rf $$newdir \
	 && cd $$olddir
