.PHONY: all clean distcleqn
.PHONY: driver clean-driver distclean-driver
.PHONY: lib clean-lib distclean-lib
.PHONY: tests clean-tests distclean-tests

all: driver lib tests

clean: clean-driver clean-lib clean-tests

distclean: distclean-driver distclean-lib distclean-tests

driver:
	$(MAKE) -C driver/linux

clean-driver:
	$(MAKE) -C driver/linux clean

distclean-driver:
	$(MAKE) -C driver/linux distclean

lib:
	$(MAKE) -C libmpoe

clean-lib:
	$(MAKE) -C libmpoe clean

distclean-lib:
	$(MAKE) -C libmpoe distclean

tests: lib
	$(MAKE) -C tests 

clean-tests:
	$(MAKE) -C tests clean

distclean-tests:
	$(MAKE) -C tests distclean

wc:
	wc -cl \
		driver/linux/*.[ch] \
		common/*.h \
		libmpoe/*.[ch] \
		tests/*.c

dist:
	olddir=$$(basename $$PWD) && newdir=mpoe-svn.$$(date +%Y%m%d.%H%M%S) && cd .. \
	 && cp -a $$olddir $$newdir && find $$newdir -type d | grep '\.svn$$' | xargs rm -rf \; \
	 && cd $$newdir && autoreconf -f && rm -rf autom4te.cache/ && cd .. \
	 && tar cfz $${newdir}.tar.gz $$newdir \
	 && rm -rf $$newdir \
	 && cd $$olddir
