SRCS	=	$(wildcard @srcdir@/*.c)
OBJS	=	$(patsubst @srcdir@/%.c,%.o,$(SRCS))
TESTS	=	$(subst .o,,$(OBJS))

CC	=	gcc

CPPFLAGS	+=	-imacros @top_builddir@/common/mpoe_config.h
CPPFLAGS	+=	-I@top_srcdir@/common -I@top_srcdir@/libmpoe
CFLAGS	+=	-Wall
CFLAGS	+=	-g -O2

LD	=	gcc

LIB	=	@top_builddir@/@LIBMPOE_A@

.PHONY: all clean distclean

all: $(TESTS)

$(TESTS): %: %.o $(LIB)
	$(LD) $^ -o $@

$(OBJS): %.o: @srcdir@/%.c @top_srcdir@/libmpoe/mpoe_lib.h @top_srcdir@/libmpoe/mpoe_internals.h
	$(CC) -c $(CPPFLAGS) $(CFLAGS) $< -o $@

clean:
	$(RM) $(TESTS) $(OBJS)

distclean: clean
